{% extends 'app_med_kit/med_kit_base.html' %}
{% load static %}

{% block title %}Manage Kit{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/manage_kit.css' %}">
{% endblock %}
{% block content %}
<h1>Manage Kit: {{ kit.name }}</h1>
<p>{{ kit.description }}</p>
<a href="{% url 'dashboard' %}">‚Üê Back to Dashboard</a>

<hr>
<h2>Drugs</h2>

{% for drug in drugs %}
<div id="drug-{{ drug.id }}" class="drug-entry">
    <form method="post" action="{% url 'edit_drug' kit.id drug.id %}" class="drug-form">
        {% csrf_token %}
        <div class="drug-info">
            <div><span class="display name"><strong>{{ drug.name }}</strong></span><input class="edit name" type="text" name="name" value="{{ drug.name }}" hidden required></div>
            <div><span class="display number">{{ drug.number }}</span><input class="edit number" type="number" name="number" value="{{ drug.number }}" hidden required></div>
            <div><span class="display price">${{ drug.price }}</span><input class="edit price" type="number" step="0.01" name="price" value="{{ drug.price }}" hidden></div>
            <div><span class="display expiration">{{ drug.expiration_date }}</span><input class="edit expiration" type="date" name="expiration_date" value="{{ drug.expiration_date|date:'Y-m-d' }}" hidden></div>
            <div class="desc-block">
                <button type="button" class="display description" onclick="showDescriptionPopup(event, '{{ drug.description|escapejs }}')">Show Description</button>
                <textarea class="edit description" name="description" hidden>{{ drug.description }}</textarea>
            </div>
        </div>
        <div class="drug-actions">
            <button type="submit" class="confirm-btn" hidden>Confirm</button>
        </div>
    </form>
    <div class="drug-actions">
        <form method="post" action="{% url 'take_drug' kit.id drug.id %}">
            {% csrf_token %}
            <button type="submit">Take</button>
        </form>
        <button type="button" class="edit-toggle-btn" onclick="toggleEdit('{{ drug.id }}')">Edit</button>
    </div>
</div>
{% endfor %}

<div id="description-popup"></div>

<a href="?add_drug=1"><button {% if show_form %}disabled{% endif %}>Add Drug</button></a>

{% if show_form %}
<div class="form-container">
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Confirm</button>
        <a href="{% url 'manage_kit' kit.id %}"><button type="button">Cancel</button></a>
    </form>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/manage_kit.js' %}"></script>
{% endblock %}
